"use strict";(self["webpackChunkvue_music"]=self["webpackChunkvue_music"]||[]).push([[643],{485:function(t,s,e){e.r(s),e.d(s,{default:function(){return u}});var i=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",[t.musicList.length>0?e("div",{staticClass:"main",class:t.flag&&!t.lock?"":"active",on:{mouseenter:t.showBar,mouseleave:t.hiddenBar}},[e("div",{staticClass:"top"},[e("div",{staticClass:"btn",on:{click:t.lockBar}},[e("span",{staticClass:"el-icon-unlock",class:t.lock?"lock":""})])]),e("div",{staticClass:"bar"},[e("el-slider",{attrs:{"show-tooltip":!1},on:{change:t.changeCurrentTime},nativeOn:{mousedown:function(s){return t.control.apply(null,arguments)}},model:{value:t.value3,callback:function(s){t.value3=s},expression:"value3"}})],1),e("div",{staticClass:"body"},[e("div",{staticClass:"player-body"},[e("div",{staticClass:"player-left"},[t.source?e("div",{staticClass:"avatar"},[t.source?e("el-image",{attrs:{src:t.source.album.picUrl+"?param=50y50",fit:"cover",lazy:!0}}):t._e()],1):t._e(),t.source?e("div",{staticClass:"song"},[e("p",{staticClass:"song-name"},[t._v(t._s(t.source.name))]),t._l(t.source.singer,(function(s,i){return e("p",{key:i,staticClass:"ar-name"},[0!==i?e("span",[t._v("/")]):t._e(),t._v(t._s(s.name)+" ")])}))],2):t._e(),t.source?e("div",{staticClass:"time"},[e("span",[t._v(t._s(t.currentTime))]),e("span",[t._v(" / ")]),e("span",[t._v(t._s(t.source.dt))])]):t._e()]),e("div",{staticClass:"player-middle"},[e("div",{staticClass:"before",on:{click:t.beforMusic}},[e("svg-icon",{staticStyle:{fontSize:"30px"},attrs:{"icon-class":"before"}})],1),t.play?e("div",{staticClass:"play",on:{click:function(s){return t.playOrParse(!1)}}},[e("svg-icon",{staticStyle:{fontSize:"30px"},attrs:{"icon-class":"play"}})],1):e("div",{staticClass:"parse",on:{click:function(s){return t.playOrParse(!0)}}},[e("svg-icon",{staticStyle:{fontSize:"30px"},attrs:{"icon-class":"parse"}})],1),e("div",{staticClass:"next",on:{click:t.nextMusic}},[e("svg-icon",{staticStyle:{fontSize:"30px"},attrs:{"icon-class":"next"}})],1)]),e("div",{staticClass:"player-right"},[t.source?e("div",{staticClass:"volume"},[e("div",{staticClass:"volume-icon"},[e("svg-icon",{staticStyle:{fontSize:"20px"},attrs:{"icon-class":"volume-icon"}})],1),e("div",{staticClass:"volume-slider"},[e("el-slider",{attrs:{"show-tooltip":!0},model:{value:t.volume,callback:function(s){t.volume=s},expression:"volume"}})],1)]):t._e(),e("el-tooltip",{attrs:{manual:!0,effect:"dark",content:t.text1,placement:"top","hide-after":500},model:{value:t.isShow,callback:function(s){t.isShow=s},expression:"isShow"}},[e("div",{staticClass:"list"},[e("el-popover",{attrs:{placement:"top-start",width:"500",trigger:"click"}},[e("div",[e("div",{staticStyle:{display:"flex","justify-content":"space-between"}},[e("span",[t._v("播放列表"),e("span",[t._v("(共"+t._s(t.musicList.length)+"首)")])]),e("span",{staticStyle:{cursor:"pointer"},on:{click:t.removeList}},[t._v("清空列表")])]),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.musicList,size:"small",height:"350"}},[e("el-table-column",{attrs:{label:"序号",align:"center"},scopedSlots:t._u([{key:"default",fn:function(s){var i=s.row,a=s.$index;return[i.id!==t.source.id||t.play?e("span",[t._v(t._s(a+1))]):e("span",[e("svg-icon",{staticStyle:{fontSize:"32px"},attrs:{"icon-class":"listPlay"}})],1)]}}],null,!1,1367788007)}),e("el-table-column",{attrs:{label:"歌曲",prop:"name"}}),e("el-table-column",{attrs:{label:"歌手"},scopedSlots:t._u([{key:"default",fn:function(s){var i=s.row;s.$index;return t._l(i.singer,(function(s,i){return e("span",{key:i},[0!==i?e("span",[t._v("/")]):t._e(),t._v(t._s(s.name))])}))}}],null,!1,1382555234)}),e("el-table-column",{attrs:{label:"时长",prop:"dt"}}),e("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:t._u([{key:"default",fn:function(s){var i=s.row;return[e("div",[e("span",{staticStyle:{cursor:"pointer"},on:{click:function(s){return t.listPlay(i)}}},[e("svg-icon",{staticStyle:{fontSize:"20px"},attrs:{"icon-class":"listPlayButton"}})],1),e("span",{staticStyle:{cursor:"pointer"},on:{click:function(s){return t.listDelete(i.id)}}},[e("svg-icon",{staticStyle:{fontSize:"20px"},attrs:{"icon-class":"listDelete"}})],1)])]}}],null,!1,3563979)})],1)],1),e("svg-icon",{staticStyle:{fontSize:"24px"},attrs:{slot:"reference","icon-class":"list"},slot:"reference"})],1)],1)])],1)])])]):t._e(),t.source?e("div",{staticClass:"audio"},[e("audio",{ref:"audio",attrs:{src:t.source.url},on:{ended:t.nextPlay,timeupdate:t.audioUpdateTime}})]):t._e()])},a=[],l=e(6294),o={data(){return{volume:50,value3:0,play:!0,source:{album:{picUrl:""},dt:"00:00"},currentTime:"00:00",isShow:!1,text1:"添加歌曲成功",flag:!1,lock:!1,timer:"",controlPro:!0}},mounted(){this.playOrParse(!0),this.$bus.$on("ADDMUSIC",(t=>{this.showBar(),this.text1=t?"添加歌曲成功":"已经添加过了！",this.isShow=!0,setTimeout((()=>{this.isShow=!1}),1e3),this.hiddenBar()})),this.$bus.$on("PLAYMUSIC",(t=>{this.showBar(),this.source=t,this.playOrParse(!1),this.hiddenBar()})),this.musicList.length>0&&(this.showBar(),this.hiddenBar(),this.source=this.musicList[0])},methods:{playOrParse(t){this.play=t,this.play?this.$refs.audio.pause():this.$nextTick((()=>{this.$refs.audio.play()}))},audioUpdateTime(t){if(this.currentTime=this.format(t.target.currentTime),this.controlPro){const s=t.target.currentTime/this.formatSongSecond(this.source.dt)*100;this.value3=Math.floor(100*s)/100}},changeCurrentTime(t){const s=this.formatSongSecond(this.source.dt)*t/100,e=this.$refs.audio;e.currentTime=s,this.value3=t,this.controlPro=!0},control(){this.controlPro=!1},format(t){const s=t,e=(Math.floor(s/60)+"").padStart(2,"0"),i=(Math.floor(s%60)+"").padStart(2,"0");return`${e}:${i}`},formatSongSecond(t){const s=t.split(":");let e=0;for(let i=0;i<s.length;i++)e+=60*s[i]*(s.length-1-i);return e+=1*s[s.length-1],e},showBar(){this.flag=!1,this.timer&&(clearInterval(this.timer),this.timer=null)},hiddenBar(){this.lock||(this.timer=setTimeout((()=>{this.flag=!0}),3e3))},lockBar(){this.lock=!this.lock},listPlay(t){const s=this.musicList.filter((s=>s.id===t.id));this.source=s[0],this.playOrParse(!1)},listDelete(t){this.$store.dispatch("deleteSong",t),this.source.id===t&&this.playOrParse(!0)},removeList(){this.$store.dispatch("removeSong",-1),this.$refs.audio.load()},nextMusic(){const t=this.musicList.findIndex((t=>t.id===this.source.id));t===this.musicList.length-1?this.source=this.musicList[0]:this.source=this.musicList[t+1],this.playOrParse(!1)},beforMusic(){const t=this.musicList.findIndex((t=>t.id===this.source.id));this.source=0===t?this.musicList[this.musicList.length-1]:this.musicList[t-1],this.playOrParse(!1)},nextPlay(){this.nextMusic()}},computed:{...(0,l.mapState)({musicList:t=>t.playBar.musicList})},watch:{volume:{immediate:!0,handler(t){this.$nextTick((()=>{const s=this.$refs.audio;s.volume=t/100}))}},source:{handler(t){t.license&&this.$message.error("无法播放")}}}},r=o,c=e(1001),n=(0,c.Z)(r,i,a,!1,null,"f7ff8324",null),u=n.exports}}]);